<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Budget Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // Icon components using simple SVG
        const Calculator = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="4" y="2" width="16" height="20" rx="2"/>
                <line x1="8" y1="6" x2="16" y2="6"/>
                <line x1="8" y1="10" x2="16" y2="10"/>
                <line x1="8" y1="14" x2="16" y2="14"/>
                <line x1="8" y1="18" x2="16" y2="18"/>
            </svg>
        );

        const ClipboardList = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="8" y="2" width="8" height="4" rx="1"/>
                <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                <path d="M12 11h4"/>
                <path d="M12 16h4"/>
                <path d="M8 11h.01"/>
                <path d="M8 16h.01"/>
            </svg>
        );

        const Plus = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const Trash2 = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="3,6 5,6 21,6"/>
                <path d="M19,6v14a2,2 0 0,1-2,2H7a2,2 0 0,1-2-2V6m3,0V4a2,2 0 0,1,2-2h4a2,2 0 0,1,2,2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
            </svg>
        );

        const TrendingUp = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="22,7 13.5,15.5 8.5,10.5 2,17"/>
                <polyline points="16,7 22,7 22,13"/>
            </svg>
        );

        const Moon = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
            </svg>
        );

        const Sun = ({ className }) => (
            <svg className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="5"/>
                <line x1="12" y1="1" x2="12" y2="3"/>
                <line x1="12" y1="21" x2="12" y2="23"/>
                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                <line x1="1" y1="12" x2="3" y2="12"/>
                <line x1="21" y1="12" x2="23" y2="12"/>
                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
            </svg>
        );

        // UK Tax Calculation Function
        const calculateUKTax = (grossIncome, pensionPercentage = 0) => {
            const personalAllowance = 12570;
            const basicRateThreshold = 50270;
            const higherRateThreshold = 125140;
            
            // Calculate National Insurance FIRST - on gross income
            let nationalInsurance = 0;
            const niLowerThreshold = 12570;
            const niUpperThreshold = 50270;
            
            if (grossIncome > niLowerThreshold) {
                const niBasic = Math.floor(Math.min(grossIncome - niLowerThreshold, niUpperThreshold - niLowerThreshold) * 0.08);
                nationalInsurance += niBasic;
                
                if (grossIncome > niUpperThreshold) {
                    const niHigher = Math.floor((grossIncome - niUpperThreshold) * 0.02);
                    nationalInsurance += niHigher;
                }
            }
            
            // Calculate pension deduction
            const pensionDeduction = Math.floor((grossIncome * pensionPercentage) / 100);
            const incomeAfterPension = grossIncome - pensionDeduction;
            
            // Calculate income tax on income after pension
            let taxableIncome = Math.max(0, incomeAfterPension - personalAllowance);
            let incomeTax = 0;
            
            if (taxableIncome > 0) {
                const basicRateTax = Math.floor(Math.min(taxableIncome, basicRateThreshold - personalAllowance) * 0.20);
                incomeTax += basicRateTax;
            }
            
            if (taxableIncome > (basicRateThreshold - personalAllowance)) {
                const higherRateIncome = Math.min(
                    taxableIncome - (basicRateThreshold - personalAllowance),
                    higherRateThreshold - basicRateThreshold
                );
                incomeTax += Math.floor(higherRateIncome * 0.40);
            }
            
            if (taxableIncome > (higherRateThreshold - personalAllowance)) {
                const additionalRateIncome = taxableIncome - (higherRateThreshold - personalAllowance);
                incomeTax += Math.floor(additionalRateIncome * 0.45);
            }
            
            const totalTax = incomeTax + nationalInsurance;
            const netIncome = grossIncome - pensionDeduction - totalTax;
            
            return {
                grossIncome,
                pensionDeduction,
                incomeAfterPension,
                incomeTax,
                nationalInsurance,
                totalTax,
                netIncome
            };
        };

        // Simple Chart Component
        const SimpleChart = ({ data, colors, isDarkMode }) => {
            const [hoveredIndex, setHoveredIndex] = useState(null);
            const total = data.reduce((sum, item) => sum + item.value, 0);
            let currentAngle = 0;

            const segments = data.map((item, index) => {
                const percentage = (item.value / total) * 100;
                const angle = (item.value / total) * 360;
                const startAngle = currentAngle;
                const endAngle = currentAngle + angle;
                
                const startAngleRad = (startAngle * Math.PI) / 180;
                const endAngleRad = (endAngle * Math.PI) / 180;
                
                const largeArcFlag = angle > 180 ? 1 : 0;
                
                const x1 = 100 + 70 * Math.cos(startAngleRad);
                const y1 = 100 + 70 * Math.sin(startAngleRad);
                const x2 = 100 + 70 * Math.cos(endAngleRad);
                const y2 = 100 + 70 * Math.sin(endAngleRad);
                
                const pathData = `M 100 100 L ${x1} ${y1} A 70 70 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;
                
                currentAngle += angle;
                
                return {
                    ...item,
                    pathData,
                    index,
                    isHovered: hoveredIndex === index,
                    isDimmed: hoveredIndex !== null && hoveredIndex !== index
                };
            });

            return (
                <div className="flex flex-col items-center">
                    <div className="relative">
                        <svg width="350" height="350" viewBox="0 0 200 200" className="mb-6">
                            {segments.map((segment) => (
                                <path
                                    key={segment.index}
                                    d={segment.pathData}
                                    fill={colors[segment.index % colors.length]}
                                    stroke={segment.isHovered ? "#374151" : isDarkMode ? "#374151" : "white"}
                                    strokeWidth={segment.isHovered ? "3" : "2"}
                                    opacity={segment.isDimmed ? 0.3 : 1}
                                    style={{
                                        cursor: 'pointer',
                                        transition: 'all 0.2s ease',
                                        filter: segment.isHovered ? 'brightness(1.1)' : 'none'
                                    }}
                                    onMouseEnter={() => setHoveredIndex(segment.index)}
                                    onMouseLeave={() => setHoveredIndex(null)}
                                />
                            ))}
                            
                            <circle 
                                cx="100" 
                                cy="100" 
                                r="35" 
                                fill={isDarkMode ? "#374151" : "white"} 
                                stroke={isDarkMode ? "#4b5563" : "#e5e7eb"} 
                                strokeWidth="2"
                            />
                            <text 
                                x="100" 
                                y="95" 
                                textAnchor="middle" 
                                className={`text-xs font-semibold ${isDarkMode ? 'fill-gray-300' : 'fill-gray-600'}`}
                            >
                                Total
                            </text>
                            <text 
                                x="100" 
                                y="108" 
                                textAnchor="middle" 
                                className={`text-sm font-bold ${isDarkMode ? 'fill-white' : 'fill-gray-800'}`}
                            >
                                £{Math.floor(total).toLocaleString()}
                            </text>
                        </svg>
                        
                        {hoveredIndex !== null && (
                            <div className={`absolute top-4 left-1/2 transform -translate-x-1/2 p-3 rounded-lg shadow-lg border z-10 ${isDarkMode ? 'bg-gray-700 border-gray-600' : 'bg-white border-gray-200'}`}>
                                <p className={`font-bold text-lg ${isDarkMode ? 'text-white' : 'text-gray-800'}`}>
                                    {segments[hoveredIndex].name}
                                </p>
                                <p className={isDarkMode ? 'text-gray-300' : 'text-gray-600'}>
                                    £{Math.floor(segments[hoveredIndex].value).toLocaleString()}
                                    {segments[hoveredIndex].amount && ` (${segments[hoveredIndex].percentage}%)`}
                                </p>
                            </div>
                        )}
                    </div>
                    
                    <div className="space-y-2 text-sm max-w-md w-full px-2">
                        {segments.map((segment) => (
                            <div 
                                key={segment.index} 
                                className={`flex items-start gap-3 p-2 rounded cursor-pointer transition-all ${segment.isHovered ? (isDarkMode ? 'bg-gray-700' : 'bg-gray-100') : ''} ${segment.isDimmed ? 'opacity-30' : ''}`}
                                onMouseEnter={() => setHoveredIndex(segment.index)}
                                onMouseLeave={() => setHoveredIndex(null)}
                            >
                                <div 
                                    className="w-4 h-4 rounded flex-shrink-0 mt-0.5"
                                    style={{ backgroundColor: colors[segment.index % colors.length] }}
                                />
                                <span className={`text-sm leading-tight break-words min-w-0 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                    {segment.name}: £{Math.floor(segment.value).toLocaleString()} ({segment.percentage}%)
                                </span>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const BudgetTracker = () => {
            const [yearlyIncome, setYearlyIncome] = useState('');
            const [isPreTax, setIsPreTax] = useState(false);
            const [pensionPercentage, setPensionPercentage] = useState('');
            const [outgoings, setOutgoings] = useState([
                { label: 'Food', amount: '' },
                { label: 'Rent / Mortgage', amount: '' },
                { label: 'Bills', amount: '' }
            ]);
            const [savingsAllocations, setSavingsAllocations] = useState([{ type: 'ISA', label: '', percentage: '', amount: '', inputType: 'percentage' }]);
            const [isDarkMode, setIsDarkMode] = useState(false);

            useEffect(() => {
                if (window.matchMedia) {
                    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    setIsDarkMode(prefersDark);
                }
            }, []);

            const toggleDarkMode = () => setIsDarkMode(!isDarkMode);

            const addOutgoing = () => {
                if (outgoings.length < 10) {
                    setOutgoings([...outgoings, { label: '', amount: '' }]);
                }
            };

            const removeOutgoing = (index) => {
                setOutgoings(outgoings.filter((_, i) => i !== index));
            };

            const updateOutgoing = (index, field, value) => {
                const updated = [...outgoings];
                
                if (field === 'amount' && incomeCalculations) {
                    const numValue = parseFloat(value) || 0;
                    const otherOutgoings = updated.reduce((sum, item, i) => {
                        if (i !== index && item.label.trim() && parseFloat(item.amount) > 0) {
                            return sum + parseFloat(item.amount);
                        }
                        return sum;
                    }, 0);
                    
                    const maxAllowed = incomeCalculations.monthlyIncome - otherOutgoings;
                    if (numValue > maxAllowed) {
                        value = Math.max(0, maxAllowed).toString();
                    }
                }
                
                updated[index][field] = value;
                setOutgoings(updated);
            };

            const addSavingsAllocation = () => {
                if (savingsAllocations.length < 8) {
                    setSavingsAllocations([...savingsAllocations, { type: 'ISA', label: '', percentage: '', amount: '', inputType: 'percentage' }]);
                }
            };

            const removeSavingsAllocation = (index) => {
                setSavingsAllocations(savingsAllocations.filter((_, i) => i !== index));
            };

            const updateSavingsAllocation = (index, field, value) => {
                const updated = [...savingsAllocations];
                updated[index][field] = value;
                setSavingsAllocations(updated);
            };

            const incomeCalculations = useMemo(() => {
                const income = parseFloat(yearlyIncome) || 0;
                if (!income) return null;

                let finalNetIncome;
                let taxBreakdown = null;

                if (isPreTax) {
                    const pensionRate = parseFloat(pensionPercentage) || 0;
                    taxBreakdown = calculateUKTax(income, pensionRate);
                    finalNetIncome = taxBreakdown.netIncome;
                } else {
                    const pensionRate = parseFloat(pensionPercentage) || 0;
                    const pensionContribution = Math.floor((income * pensionRate) / 100);
                    finalNetIncome = income - pensionContribution;
                    
                    taxBreakdown = {
                        grossIncome: income,
                        pensionDeduction: pensionContribution,
                        netIncome: finalNetIncome
                    };
                }

                return {
                    finalNetIncome,
                    monthlyIncome: finalNetIncome / 12,
                    taxBreakdown
                };
            }, [yearlyIncome, isPreTax, pensionPercentage]);

            const chartData = useMemo(() => {
                if (!incomeCalculations) return [];
                
                const monthlyIncome = incomeCalculations.monthlyIncome;
                
                const validOutgoings = outgoings.filter(
                    item => item.label.trim() && parseFloat(item.amount) > 0
                );
                
                const totalOutgoings = validOutgoings.reduce(
                    (sum, item) => sum + parseFloat(item.amount), 0
                );
                
                const remaining = monthlyIncome - totalOutgoings;
                
                const data = validOutgoings.map(item => ({
                    name: item.label,
                    value: Math.floor(parseFloat(item.amount)),
                    percentage: ((parseFloat(item.amount) / monthlyIncome) * 100).toFixed(1)
                }));
                
                if (remaining > 0) {
                    data.push({
                        name: 'Remaining Budget',
                        value: Math.floor(remaining),
                        percentage: ((remaining / monthlyIncome) * 100).toFixed(1)
                    });
                }
                
                return data.filter(item => item.value > 0);
            }, [incomeCalculations, outgoings]);

            const savingsCalculations = useMemo(() => {
                if (!incomeCalculations) return null;
                
                const monthlyIncome = incomeCalculations.monthlyIncome;
                
                const totalOutgoings = outgoings.reduce((sum, item) => {
                    const amount = parseFloat(item.amount) || 0;
                    return item.label.trim() && amount > 0 ? sum + amount : sum;
                }, 0);
                
                const remainingAfterExpenses = monthlyIncome - totalOutgoings;
                
                if (remainingAfterExpenses <= 0) {
                    return { remainingAfterExpenses: 0, savingsBreakdown: [], finalRemaining: 0, totalPercentage: 0 };
                }
                
                const validSavings = savingsAllocations.filter(
                    item => item.label.trim() && (parseFloat(item.percentage) > 0 || parseFloat(item.amount) > 0)
                );
                
                let totalPercentage = 0;
                const savingsBreakdown = validSavings.map(saving => {
                    let percentage, amount;
                    
                    if (saving.inputType === 'amount') {
                        amount = Math.floor(parseFloat(saving.amount) || 0);
                        percentage = remainingAfterExpenses > 0 ? (amount / remainingAfterExpenses) * 100 : 0;
                    } else {
                        percentage = parseFloat(saving.percentage) || 0;
                        amount = Math.floor((remainingAfterExpenses * percentage) / 100);
                    }
                    
                    totalPercentage += percentage;
                    
                    return {
                        type: saving.type,
                        label: saving.label,
                        percentage: Math.round(percentage * 100) / 100, // Round to 2 decimal places
                        amount
                    };
                });
                
                const totalSavingsAmount = savingsBreakdown.reduce((sum, saving) => sum + saving.amount, 0);
                const finalRemaining = Math.floor(remainingAfterExpenses - totalSavingsAmount);
                
                return {
                    remainingAfterExpenses: Math.floor(remainingAfterExpenses),
                    savingsBreakdown,
                    totalSavingsAmount,
                    finalRemaining,
                    totalPercentage,
                    isOverAllocated: totalPercentage > 100
                };
            }, [incomeCalculations, outgoings, savingsAllocations]);

            const savingsChartData = useMemo(() => {
                if (!savingsCalculations || savingsCalculations.savingsBreakdown.length === 0) return [];
                
                const validSavings = savingsCalculations.savingsBreakdown.filter(saving => saving.amount > 0);
                const totalAllocatedPercentage = validSavings.reduce((sum, saving) => sum + saving.percentage, 0);
                
                const data = validSavings.map(saving => ({
                    name: `${saving.type}: ${saving.label}`,
                    value: saving.amount, // Use actual monetary amount, not percentage
                    amount: saving.amount,
                    percentage: saving.percentage.toFixed(1)
                }));
                
                // Add unallocated if total is less than 100%
                if (totalAllocatedPercentage < 100) {
                    const unallocated = 100 - totalAllocatedPercentage;
                    const unallocatedAmount = Math.floor((savingsCalculations.remainingAfterExpenses * unallocated) / 100);
                    data.push({
                        name: 'Unallocated',
                        value: unallocatedAmount, // Use actual monetary amount
                        amount: unallocatedAmount,
                        percentage: unallocated.toFixed(1)
                    });
                }
                
                return data;
            }, [savingsCalculations]);

            const colors = [
                '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444',
                '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444',
                '#6b7280', '#3b82f6'
            ];

            const savingsColors = [
                '#10b981', '#06b6d4', '#8b5cf6', '#f59e0b', '#ef4444',
                '#10b981', '#06b6d4', '#8b5cf6', '#f59e0b', '#ef4444',
                '#9ca3af'
            ];

            const hasData = incomeCalculations && chartData.length > 0;
            const hasSavingsData = savingsCalculations && savingsChartData.length > 0;

            const panelClass = isDarkMode ? 'bg-gray-800' : 'bg-white';
            const textClass = isDarkMode ? 'text-white' : 'text-gray-800';
            const textSecondaryClass = isDarkMode ? 'text-gray-300' : 'text-gray-600';
            const inputClass = isDarkMode ? 'bg-gray-700 border-gray-600 text-white placeholder-gray-400' : 'bg-white border-gray-300 text-gray-900 placeholder-gray-500';

            return (
                <div className={`min-h-screen transition-colors duration-300 p-6 ${isDarkMode ? 'bg-gradient-to-br from-gray-900 to-gray-800' : 'bg-gradient-to-br from-blue-50 to-indigo-100'}`}>
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-8">
                            <div className="flex items-center justify-center gap-4 mb-4">
                                <h1 className={`text-4xl font-bold mb-2 ${textClass}`}>
                                    <Calculator className={`inline-block mr-3 w-8 h-8 ${isDarkMode ? 'text-indigo-400' : 'text-indigo-600'}`} />
                                    UK Budget Tracker
                                </h1>
                                <button
                                    onClick={toggleDarkMode}
                                    className={`p-2 rounded-lg transition-colors ${isDarkMode ? 'bg-gray-700 hover:bg-gray-600 text-yellow-400' : 'bg-white hover:bg-gray-50 text-gray-600 shadow-lg'}`}
                                    title={isDarkMode ? 'Switch to light mode' : 'Switch to dark mode'}
                                >
                                    {isDarkMode ? <Sun className="w-5 h-5" /> : <Moon className="w-5 h-5" />}
                                </button>
                            </div>
                            <p className={textSecondaryClass}>
                                Calculate your post-tax budget with pension contributions and savings allocation
                            </p>
                        </div>

                        <div className="grid xl:grid-cols-4 lg:grid-cols-2 grid-cols-1 gap-6">
                            {/* Budget Details Panel */}
                            <div className={`rounded-2xl shadow-xl p-6 lg:p-8 ${panelClass}`}>
                                <h2 className={`text-xl lg:text-2xl font-semibold mb-6 flex items-center ${textClass}`}>
                                    <ClipboardList className={`mr-2 w-5 h-5 lg:w-6 lg:h-6 ${isDarkMode ? 'text-green-400' : 'text-green-600'}`} />
                                    Budget Details
                                </h2>
                                
                                {/* Income Section */}
                                <div className="mb-6">
                                    <label className={`block text-sm font-medium mb-2 ${isDarkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                        Yearly Income
                                    </label>
                                    <input
                                        type="number"
                                        value={yearlyIncome}
                                        onChange={(e) => setYearlyIncome(e.target.value)}
                                        placeholder="Enter your yearly income"
                                        className={`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all ${inputClass}`}
                                    />
                                    
                                    <div className="mt-3 flex items-center space-x-4">
                                        <label className="flex items-center">
                                            <input
                                                type="radio"
                                                name="taxType"
                                                checked={!isPreTax}
                                                onChange={() => setIsPreTax(false)}
                                                className="mr-2 text-indigo-600"
                                            />
                                            <span className={`text-sm ${textSecondaryClass}`}>After Tax</span>
                                        </label>
                                        <label className="flex items-center">
                                            <input
                                                type="radio"
                                                name="taxType"
                                                checked={isPreTax}
                                                onChange={() => setIsPreTax(true)}
                                                className="mr-2 text-indigo-600"
                                            />
                                            <span className={`text-sm ${textSecondaryClass}`}>Before Tax</span>
                                        </label>
                                    </div>
                                    
                                    {incomeCalculations && (
                                        <div className={`mt-3 text-sm rounded-lg p-3 ${isDarkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-50 text-gray-600'}`}>
                                            {isPreTax && incomeCalculations.taxBreakdown && (
                                                <div className="space-y-1">
                                                    <p><strong>Gross Income:</strong> £{incomeCalculations.taxBreakdown.grossIncome.toLocaleString()}</p>
                                                    {incomeCalculations.taxBreakdown.pensionDeduction > 0 && (
                                                        <p><strong>Pension Deductions:</strong> £{incomeCalculations.taxBreakdown.pensionDeduction.toLocaleString()}</p>
                                                    )}
                                                    <p><strong>Taxable Income:</strong> £{incomeCalculations.taxBreakdown.incomeAfterPension.toLocaleString()}</p>
                                                    <p><strong>Income Tax:</strong> £{incomeCalculations.taxBreakdown.incomeTax.toLocaleString()}</p>
                                                    <p><strong>National Insurance:</strong> £{incomeCalculations.taxBreakdown.nationalInsurance.toLocaleString()}</p>
                                                    <p><strong>Take Home:</strong> £{incomeCalculations.taxBreakdown.netIncome.toLocaleString()}</p>
                                                </div>
                                            )}
                                            {!isPreTax && incomeCalculations.taxBreakdown.pensionDeduction > 0 && (
                                                <div className="space-y-1">
                                                    <p><strong>After Tax Income:</strong> £{incomeCalculations.taxBreakdown.grossIncome.toLocaleString()}</p>
                                                    <p><strong>Pension Contribution:</strong> £{incomeCalculations.taxBreakdown.pensionDeduction.toLocaleString()}</p>
                                                    <p><strong>Final Net Income:</strong> £{incomeCalculations.finalNetIncome.toLocaleString()}</p>
                                                </div>
                                            )}
                                            <p className={`font-semibold mt-2 pt-2 border-t ${isDarkMode ? 'border-gray-600' : 'border-gray-200'}`}>
                                                <strong>Monthly Available:</strong> £{Math.floor(incomeCalculations.monthlyIncome).toLocaleString()}
                                            </p>
                                        </div>
                                    )}
                                </div>

                                {/* Pension Section */}
                                <div className="mb-6">
                                    <label className={`block text-sm font-medium mb-2 ${textSecondaryClass}`}>
                                        Pension Contribution (%)
                                    </label>
                                    <input
                                        type="number"
                                        min="0"
                                        max="100"
                                        step="0.1"
                                        value={pensionPercentage}
                                        onChange={(e) => setPensionPercentage(e.target.value)}
                                        placeholder="Enter pension percentage (e.g., 5)"
                                        className={`w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all ${inputClass}`}
                                    />
                                    <p className={`text-xs mt-1 ${isDarkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                                        Optional: Percentage of your net income to contribute to pension
                                    </p>
                                </div>
                                
                                {/* Outgoings Section */}
                                <div className="mb-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <label className={`block text-sm font-medium ${textSecondaryClass}`}>
                                            Monthly Outgoings (£)
                                        </label>
                                        <button
                                            onClick={addOutgoing}
                                            disabled={outgoings.length >= 10}
                                            className="flex items-center px-3 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                                        >
                                            <Plus className="w-4 h-4 mr-1" />
                                            Add
                                        </button>
                                    </div>
                                    
                                    <div className="space-y-3">
                                        {outgoings.map((outgoing, index) => (
                                            <div key={index} className="flex gap-2">
                                                <input
                                                    type="text"
                                                    value={outgoing.label}
                                                    onChange={(e) => updateOutgoing(index, 'label', e.target.value)}
                                                    placeholder="Label (e.g., Rent)"
                                                    className={`flex-1 min-w-0 px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all ${inputClass}`}
                                                />
                                                <input
                                                    type="number"
                                                    value={outgoing.amount}
                                                    onChange={(e) => updateOutgoing(index, 'amount', e.target.value)}
                                                    placeholder="£"
                                                    className={`w-20 sm:w-24 px-2 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all ${inputClass}`}
                                                />
                                                <button
                                                    onClick={() => removeOutgoing(index)}
                                                    className="w-10 h-10 flex items-center justify-center bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex-shrink-0"
                                                    title="Remove item"
                                                >
                                                    <Trash2 className="w-4 h-4" />
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Summary */}
                                {hasData && (
                                    <div className={`rounded-lg p-4 ${isDarkMode ? 'bg-gray-700' : 'bg-gray-50'}`}>
                                        <h3 className={`font-semibold mb-2 ${textClass}`}>Monthly Summary</h3>
                                        <div className={`text-sm space-y-1 ${textSecondaryClass}`}>
                                            <p>Available Income: £{Math.floor(incomeCalculations.monthlyIncome).toLocaleString()}</p>
                                            <p>Total Expenses: £{Math.floor(chartData.reduce((sum, item) => 
                                                item.name !== 'Remaining Budget' ? sum + item.value : sum, 0
                                            )).toLocaleString()}</p>
                                            <p className={`font-semibold ${
                                                chartData.find(item => item.name === 'Remaining Budget')
                                                    ? 'text-green-600' : 'text-red-600'
                                            }`}>
                                                {chartData.find(item => item.name === 'Remaining Budget')
                                                    ? `Remaining: £${Math.floor(chartData.find(item => item.name === 'Remaining Budget').value).toLocaleString()}`
                                                    : 'Over Budget!'}
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Budget Chart */}
                            <div className={`rounded-2xl shadow-xl p-6 lg:p-8 ${panelClass}`}>
                                <h2 className={`text-xl lg:text-2xl font-semibold mb-6 text-center ${textClass}`}>
                                    Budget Breakdown
                                </h2>
                                
                                {hasData ? (
                                    <div className="flex justify-center">
                                        <SimpleChart data={chartData} colors={colors} isDarkMode={isDarkMode} />
                                    </div>
                                ) : (
                                    <div className="h-96 flex items-center justify-center">
                                        <div className="text-center">
                                            <Calculator className={`min-12 h-12 lg:w-16 lg:h-16 mx-auto mb-4 ${isDarkMode ? 'text-gray-600' : 'text-gray-400'}`} />
                                            <p className={`text-base lg:text-lg ${textSecondaryClass}`}>
                                                Enter your budget details to see the breakdown
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Savings Allocation Panel */}
                            <div className={`rounded-2xl shadow-xl p-6 lg:p-8 ${panelClass}`}>
                                <h2 className={`text-xl lg:text-2xl font-semibold mb-6 flex items-center ${textClass}`}>
                                    <TrendingUp className={`mr-2 w-5 h-5 lg:w-6 lg:h-6 ${isDarkMode ? 'text-blue-400' : 'text-blue-600'}`} />
                                    Savings Allocation
                                </h2>
                                
                                {savingsCalculations && savingsCalculations.remainingAfterExpenses > 0 ? (
                                    <>
                                        <div className="mb-6">
                                            <div className="mb-4">
                                                <p className={`text-sm mb-2 ${textSecondaryClass}`}>
                                                    Available for savings: <span className="font-semibold text-green-600">£{savingsCalculations.remainingAfterExpenses.toLocaleString()}</span> per month
                                                </p>
                                                {savingsCalculations.totalPercentage > 0 && (
                                                    <p className={`text-sm font-medium ${savingsCalculations.isOverAllocated ? 'text-red-600' : 'text-blue-600'}`}>
                                                        Total allocation: {savingsCalculations.totalPercentage.toFixed(1)}%
                                                        {savingsCalculations.isOverAllocated && ' (Over 100%!)'}
                                                    </p>
                                                )}
                                            </div>
                                            
                                            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-4">
                                                <label className={`block text-sm font-medium ${textSecondaryClass}`}>
                                                    Savings Goals
                                                </label>
                                                <button
                                                    onClick={addSavingsAllocation}
                                                    disabled={savingsAllocations.length >= 8}
                                                    className="flex items-center px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors w-fit"
                                                >
                                                    <Plus className="w-4 h-4 mr-1" />
                                                    Add Goal
                                                </button>
                                            </div>
                                            
                                            <div className="space-y-3">
                                                {savingsAllocations.map((saving, index) => (
                                                    <div key={index} className="flex gap-2">
                                                        <select
                                                            value={saving.type}
                                                            onChange={(e) => updateSavingsAllocation(index, 'type', e.target.value)}
                                                            className={`w-20 sm:w-24 px-1 sm:px-2 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-xs flex-shrink-0 ${inputClass}`}
                                                        >
                                                            <option value="ISA">ISA</option>
                                                            <option value="SIPP">SIPP</option>
                                                            <option value="Stocks">Stocks</option>
                                                            <option value="Bonds">Bonds</option>
                                                            <option value="Crypto">Crypto</option>
                                                            <option value="Savings">Savings</option>
                                                            <option value="Emergency">Emergency</option>
                                                            <option value="Other">Other</option>
                                                        </select>
                                                        <input
                                                            type="text"
                                                            value={saving.label}
                                                            onChange={(e) => updateSavingsAllocation(index, 'label', e.target.value)}
                                                            placeholder="House deposit"
                                                            className={`flex-1 min-w-0 px-2 sm:px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all ${inputClass}`}
                                                        />
                                                        <select
                                                            value={saving.inputType}
                                                            onChange={(e) => updateSavingsAllocation(index, 'inputType', e.target.value)}
                                                            className={`min-12 sm:w-16 px-1 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-xs flex-shrink-0 ${inputClass}`}
                                                        >
                                                            <option value="percentage">%</option>
                                                            <option value="amount">£</option>
                                                        </select>
                                                        <input
                                                            type="number"
                                                            min="0"
                                                            max={saving.inputType === 'percentage' ? '100' : undefined}
                                                            step={saving.inputType === 'percentage' ? '0.1' : '1'}
                                                            value={saving.inputType === 'percentage' ? saving.percentage : saving.amount}
                                                            onChange={(e) => updateSavingsAllocation(index, saving.inputType, e.target.value)}
                                                            placeholder={saving.inputType === 'percentage' ? '0%' : '£0'}
                                                            className={`w-20 sm:w-24 px-1 sm:px-2 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-left flex-shrink-0 ${inputClass}`}
                                                        />
                                                        {savingsAllocations.length > 1 && (
                                                            <button
                                                                onClick={() => removeSavingsAllocation(index)}
                                                                className="w-10 h-10 flex items-center justify-center bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex-shrink-0"
                                                                title="Remove savings goal"
                                                            >
                                                                <Trash2 className="w-4 h-4" />
                                                            </button>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        </div>

                                        {/* Savings Breakdown */}
                                        {savingsCalculations.savingsBreakdown.length > 0 && (
                                            <div className={`rounded-lg p-4 ${savingsCalculations.isOverAllocated ? 'bg-red-50 border border-red-200' : isDarkMode ? 'bg-gray-700' : 'bg-blue-50'}`}>
                                                <h3 className={`font-semibold mb-3 ${textClass}`}>Monthly Savings Breakdown</h3>
                                                {savingsCalculations.isOverAllocated && (
                                                    <div className="mb-3 p-2 bg-red-100 border border-red-300 rounded text-red-700 text-sm">
                                                        ⚠️ Total allocation exceeds 100%. Please adjust percentages.
                                                    </div>
                                                )}
                                                <div className="space-y-2">
                                                    {savingsCalculations.savingsBreakdown.map((saving, index) => (
                                                        <div key={index} className="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2 text-sm">
                                                            <span className={textSecondaryClass}>
                                                                <span className={`inline-block min-12 text-xs px-2 py-1 rounded mr-2 ${savingsCalculations.isOverAllocated ? 'bg-red-100 text-red-800' : isDarkMode ? 'bg-gray-600 text-gray-200' : 'bg-blue-100 text-blue-800'}`}>
                                                                    {saving.type}
                                                                </span>
                                                                {saving.label}
                                                            </span>
                                                            <span className={`font-semibold ${savingsCalculations.isOverAllocated ? 'text-red-600' : isDarkMode ? 'text-blue-400' : 'text-blue-600'}`}>
                                                                £{saving.amount.toLocaleString()} ({saving.percentage}%)
                                                            </span>
                                                        </div>
                                                    ))}
                                                    <div className={`border-t pt-2 mt-3 ${savingsCalculations.isOverAllocated ? 'border-red-200' : isDarkMode ? 'border-gray-600' : 'border-blue-200'}`}>
                                                        <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1 font-semibold">
                                                            <span className={textClass}>Total Savings:</span>
                                                            <span className={savingsCalculations.isOverAllocated ? 'text-red-600' : isDarkMode ? 'text-blue-400' : 'text-blue-600'}>
                                                                £{savingsCalculations.totalSavingsAmount.toLocaleString()}
                                                            </span>
                                                        </div>
                                                        <div className="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-1 font-semibold mt-1">
                                                            <span className={textClass}>Final Remaining:</span>
                                                            <span className={`${savingsCalculations.finalRemaining >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                                                £{savingsCalculations.finalRemaining.toLocaleString()}
                                                            </span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </>
                                ) : (
                                    <div className="text-center py-8">
                                        <TrendingUp className={`min-12 h-12 lg:w-16 lg:h-16 mx-auto mb-4 ${isDarkMode ? 'text-gray-600' : 'text-gray-400'}`} />
                                        <p className={`text-sm lg:text-base ${textSecondaryClass}`}>
                                            {savingsCalculations && savingsCalculations.remainingAfterExpenses === 0 ? 
                                                "No budget available for savings" : 
                                                "Complete your budget to see savings allocation"
                                            }
                                        </p>
                                    </div>
                                )}
                            </div>

                            {/* Savings Chart */}
                            <div className={`rounded-2xl shadow-xl p-6 lg:p-8 ${panelClass}`}>
                                <h2 className={`text-xl lg:text-2xl font-semibold mb-6 text-center ${textClass}`}>
                                    Savings Distribution
                                </h2>
                                
                                {hasSavingsData && savingsCalculations.remainingAfterExpenses > 0 ? (
                                    <div className="flex justify-center">
                                        <SimpleChart data={savingsChartData} colors={savingsColors} isDarkMode={isDarkMode} />
                                    </div>
                                ) : (
                                    <div className="h-96 flex items-center justify-center">
                                        <div className="text-center">
                                            <TrendingUp className={`min-12 h-12 lg:w-16 lg:h-16 mx-auto mb-4 ${isDarkMode ? 'text-gray-600' : 'text-gray-400'}`} />
                                            <p className={`text-base lg:text-lg ${textSecondaryClass}`}>
                                                {savingsCalculations && savingsCalculations.remainingAfterExpenses === 0 ? 
                                                    "No budget available for savings" : 
                                                    "Set up savings goals to see distribution"
                                                }
                                            </p>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<BudgetTracker />, document.getElementById('root'));
    </script>
</body>
</html>
